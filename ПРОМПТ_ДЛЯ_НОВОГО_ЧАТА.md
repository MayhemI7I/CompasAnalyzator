# Промпт для продолжения работы над Compass Analyzer

## Контекст проекта

Я работаю над **веб-приложением для анализа калибровки компасов** на Go + Vanilla JavaScript.

**Путь к проекту:** `H:\Study`

---

## Текущая проблема

### 1. Алгоритм определения поворотов работает неправильно

**Критерии правильной калибровки:**
- Ровно **4 поворота** на ~90° (±10°)
- Все повороты **в одном направлении** (по часовой стрелке)
- Последовательность: 0° → 90° → 180° → 270° → 360° (или любая другая последовательность с шагом ~90°)

**Что происходит сейчас:**

**Пример 1 (неправильно признается валидным):**
```
Найдено 4 поворота:
1. 266.94° → 1.00° (Δ = 94.06°) - ПО часовой ✓
2. 1.00° → 267.00° (Δ = 94.00°) - ПРОТИВ часовой ✗ (возврат назад!)
3. 267.00° → 348.67° (Δ = 81.67°) - ПО часовой ✓
4. 174.75° → 267.00° (Δ = 92.25°) - ПО часовой ✓

Результат: "✓ КАЛИБРОВКА УСПЕШНА" ← НЕПРАВИЛЬНО!
Должно быть: "✗ НЕ ПРОШЛА" (поворот #2 в обратном направлении)
```

**Пример 2 (неправильно признается невалидным):**
```
Стабильные сегменты:
- Сегмент 1: 261.43° (индексы 131-146)
- Сегмент 2: 351.33° (индексы 147-151)
- [короткие отклоненные сегменты индексы 152-153]
- Сегмент 3: 164.00° (индексы 154-160)
- Сегмент 4: 259.31° (индексы 161-178)

Алгоритм находит только 2 поворота:
1. 261.43° → 351.33° (Δ = 89.90°) ✓
2. 164.00° → 259.31° (Δ = 95.31°) ✓

Результат: "✗ НЕ ПРОШЛА" (найдено 2/4 поворота) ← НЕПРАВИЛЬНО!
Должно быть: "✓ УСПЕШНА" (4 поворота: 261→351→77→165→260)
```
 еще анализ кейс определилавсь как  валидная 
 #	Начальный угол	Конечный угол	Изменение	Статус
#1	141.14°	233.42°	92.27°	check_circle
#2	333.67°	57.00°	83.33°	check_circle
#3	57.00°	141.33°	84.33°	check_circle
#4	141.33°	233.75°	92.42°	check_circle

на втором угле должно быть 233 наччальный 333 конечный  а след по замерам угол  57 прилагаю полный лог проаанлизируй и подправбт и под эту логику лог :(╔════════════════════════════════════════════════════════════╗
║         АНАЛИЗ ДАННЫХ КОМПАСА (новый алгоритм)          ║
╚════════════════════════════════════════════════════════════╝

Всего записей углов: 397

Параметры анализа:
  • Порог стабильности: 5.00°
  • Допуск поворота (90±X): ±10.00°
  • Минимальная длина сегмента: 3 записей
  • Максимум выбросов (гистерезис): 2

=== Начало поиска стабильных сегментов (новая логика) ===
Параметры: stabilityThreshold=5.00°, minStableLen=3, maxOutliers=2
Всего углов для анализа: 397

--- Новый сегмент с индекса 0 (угол: 168.00°) ---
  Индекс 1: угол 168.00°, разница с avg 168.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 2: угол 168.00°, разница с avg 168.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 3: угол 168.00°, разница с avg 168.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 4: угол 168.00°, разница с avg 168.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 5: угол 166.00°, разница с avg 168.00° = 2.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 6: угол 164.00°, разница с avg 167.67° = 3.67°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 7: угол 164.00°, разница с avg 167.14° = 3.14°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 8: угол 160.00°, разница с avg 166.75° = 6.75°
    ! Выброс 1/2, пропускаем и продолжаем
  Индекс 9: угол 164.00°, разница с avg 166.75° = 2.75°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 10: угол 164.00°, разница с avg 166.44° = 2.44°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 11: угол 164.00°, разница с avg 166.20° = 2.20°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 12: угол 164.00°, разница с avg 166.00° = 2.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 13: угол 164.00°, разница с avg 165.83° = 1.83°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 14: угол 164.00°, разница с avg 165.69° = 1.69°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 15: угол 164.00°, разница с avg 165.57° = 1.57°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 16: угол 164.00°, разница с avg 165.47° = 1.47°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 17: угол 164.00°, разница с avg 165.37° = 1.37°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 18: угол 164.00°, разница с avg 165.29° = 1.29°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 19: угол 164.00°, разница с avg 165.22° = 1.22°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 20: угол 164.00°, разница с avg 165.16° = 1.16°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 21: угол 164.00°, разница с avg 165.10° = 1.10°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 22: угол 164.00°, разница с avg 165.05° = 1.05°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 23: угол 164.00°, разница с avg 165.00° = 1.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 24: угол 164.00°, разница с avg 164.96° = 0.96°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 25: угол 164.00°, разница с avg 164.92° = 0.92°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 26: угол 164.00°, разница с avg 164.88° = 0.88°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 27: угол 164.00°, разница с avg 164.85° = 0.85°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 28: угол 164.00°, разница с avg 164.81° = 0.81°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 29: угол 164.00°, разница с avg 164.79° = 0.79°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 30: угол 164.00°, разница с avg 164.76° = 0.76°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 31: угол 164.00°, разница с avg 164.73° = 0.73°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 32: угол 166.00°, разница с avg 164.71° = 1.29°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 33: угол 167.00°, разница с avg 164.75° = 2.25°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 34: угол 167.00°, разница с avg 164.82° = 2.18°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 35: угол 167.00°, разница с avg 164.88° = 2.12°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 36: угол 168.00°, разница с avg 164.94° = 3.06°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 37: угол 168.00°, разница с avg 165.03° = 2.97°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 38: угол 168.00°, разница с avg 165.11° = 2.89°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 39: угол 168.00°, разница с avg 165.18° = 2.82°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 40: угол 168.00°, разница с avg 165.26° = 2.74°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 41: угол 168.00°, разница с avg 165.32° = 2.68°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 42: угол 168.00°, разница с avg 165.39° = 2.61°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 43: угол 168.00°, разница с avg 165.45° = 2.55°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 44: угол 168.00°, разница с avg 165.51° = 2.49°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 45: угол 168.00°, разница с avg 165.57° = 2.43°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 46: угол 168.00°, разница с avg 165.62° = 2.38°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 47: угол 168.00°, разница с avg 165.67° = 2.33°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 48: угол 168.00°, разница с avg 165.72° = 2.28°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 49: угол 168.00°, разница с avg 165.77° = 2.23°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 50: угол 168.00°, разница с avg 165.82° = 2.18°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 51: угол 168.00°, разница с avg 165.86° = 2.14°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 52: угол 168.00°, разница с avg 165.90° = 2.10°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 53: угол 168.00°, разница с avg 165.94° = 2.06°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 54: угол 167.00°, разница с avg 165.98° = 1.02°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 55: угол 165.00°, разница с avg 166.00° = 1.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 56: угол 165.00°, разница с avg 165.98° = 0.98°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 57: угол 165.00°, разница с avg 165.96° = 0.96°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 58: угол 165.00°, разница с avg 165.95° = 0.95°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 59: угол 165.00°, разница с avg 165.93° = 0.93°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 60: угол 165.00°, разница с avg 165.92° = 0.92°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 61: угол 165.00°, разница с avg 165.90° = 0.90°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 62: угол 165.00°, разница с avg 165.89° = 0.89°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 63: угол 165.00°, разница с avg 165.87° = 0.87°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 64: угол 166.00°, разница с avg 165.86° = 0.14°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 65: угол 166.00°, разница с avg 165.86° = 0.14°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 66: угол 166.00°, разница с avg 165.86° = 0.14°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 67: угол 166.00°, разница с avg 165.86° = 0.14°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 68: угол 166.00°, разница с avg 165.87° = 0.13°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 69: угол 166.00°, разница с avg 165.87° = 0.13°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 70: угол 166.00°, разница с avg 165.87° = 0.13°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 71: угол 166.00°, разница с avg 165.87° = 0.13°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 72: угол 167.00°, разница с avg 165.87° = 1.13°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 73: угол 167.00°, разница с avg 165.89° = 1.11°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 74: угол 167.00°, разница с avg 165.90° = 1.10°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 75: угол 167.00°, разница с avg 165.92° = 1.08°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 76: угол 158.00°, разница с avg 165.93° = 7.93°
    ! Выброс 1/2, пропускаем и продолжаем
  Индекс 77: угол 158.00°, разница с avg 165.93° = 7.93°
    ! Выброс 2/2, пропускаем и продолжаем
  Индекс 78: угол 158.00°, разница с avg 165.93° = 7.93°
    ✗ Превышен лимит выбросов или большая разница, конец сегмента
  ✓ Сегмент [0:77] принят: длина=75, avg=165.93°, outliers=2

--- Новый сегмент с индекса 78 (угол: 158.00°) ---
  Индекс 79: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 80: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 81: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 82: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 83: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 84: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 85: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 86: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 87: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 88: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 89: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 90: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 91: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 92: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 93: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 94: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 95: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 96: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 97: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 98: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 99: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 100: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 101: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 102: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 103: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 104: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 105: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 106: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 107: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 108: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 109: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 110: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 111: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 112: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 113: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 114: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 115: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 116: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 117: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 118: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 119: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 120: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 121: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 122: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 123: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 124: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 125: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 126: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 127: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 128: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 129: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 130: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 131: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 132: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 133: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 134: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 135: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 136: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 137: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 138: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 139: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 140: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 141: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 142: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 143: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 144: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 145: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 146: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 147: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 148: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 149: угол 161.00°, разница с avg 158.00° = 3.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 150: угол 161.00°, разница с avg 158.04° = 2.96°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 151: угол 151.00°, разница с avg 158.08° = 7.08°
    ! Выброс 1/2, пропускаем и продолжаем
  Индекс 152: угол 151.00°, разница с avg 158.08° = 7.08°
    ! Выброс 2/2, пропускаем и продолжаем
  Индекс 153: угол 151.00°, разница с avg 158.08° = 7.08°
    ✗ Превышен лимит выбросов или большая разница, конец сегмента
  ✓ Сегмент [78:152] принят: длина=73, avg=158.08°, outliers=2

--- Новый сегмент с индекса 153 (угол: 151.00°) ---
  Индекс 154: угол 151.00°, разница с avg 151.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 155: угол 151.00°, разница с avg 151.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 156: угол 151.00°, разница с avg 151.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 157: угол 151.00°, разница с avg 151.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 158: угол 151.00°, разница с avg 151.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 159: угол 151.00°, разница с avg 151.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 160: угол 151.00°, разница с avg 151.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 161: угол 151.00°, разница с avg 151.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 162: угол 151.00°, разница с avg 151.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 163: угол 151.00°, разница с avg 151.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 164: угол 151.00°, разница с avg 151.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 165: угол 151.00°, разница с avg 151.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 166: угол 154.00°, разница с avg 151.00° = 3.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 167: угол 158.00°, разница с avg 151.21° = 6.79°
    ! Выброс 1/2, пропускаем и продолжаем
  Индекс 168: угол 158.00°, разница с avg 151.21° = 6.79°
    ! Выброс 2/2, пропускаем и продолжаем
  Индекс 169: угол 158.00°, разница с avg 151.21° = 6.79°
    ✗ Превышен лимит выбросов или большая разница, конец сегмента
  ✓ Сегмент [153:168] принят: длина=14, avg=151.21°, outliers=2

--- Новый сегмент с индекса 169 (угол: 158.00°) ---
  Индекс 170: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 171: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 172: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 173: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 174: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 175: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 176: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 177: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 178: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 179: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 180: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 181: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 182: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 183: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 184: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 185: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 186: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 187: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 188: угол 158.00°, разница с avg 158.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 189: угол 240.00°, разница с avg 158.00° = 82.00°
    ! Выброс 1/2, пропускаем и продолжаем
  Индекс 190: угол 280.00°, разница с avg 158.00° = 122.00°
    ! Выброс 2/2, пропускаем и продолжаем
  Индекс 191: угол 317.00°, разница с avg 158.00° = 159.00°
    ✗ Превышен лимит выбросов или большая разница, конец сегмента
  ✓ Сегмент [169:190] принят: длина=20, avg=158.00°, outliers=2

--- Новый сегмент с индекса 191 (угол: 317.00°) ---
  Индекс 192: угол 354.00°, разница с avg 317.00° = 37.00°
    ! Выброс 1/2, пропускаем и продолжаем
  Индекс 193: угол 34.00°, разница с avg 317.00° = 77.00°
    ! Выброс 2/2, пропускаем и продолжаем
  Индекс 194: угол 77.00°, разница с avg 317.00° = 120.00°
    ✗ Превышен лимит выбросов или большая разница, конец сегмента
  ✗ Сегмент [191:193] отклонён: длина=1 < min=3

--- Новый сегмент с индекса 192 (угол: 354.00°) ---
  Индекс 193: угол 34.00°, разница с avg 354.00° = 40.00°
    ! Выброс 1/2, пропускаем и продолжаем
  Индекс 194: угол 77.00°, разница с avg 354.00° = 83.00°
    ! Выброс 2/2, пропускаем и продолжаем
  Индекс 195: угол 119.00°, разница с avg 354.00° = 125.00°
    ✗ Превышен лимит выбросов или большая разница, конец сегмента
  ✗ Сегмент [192:194] отклонён: длина=1 < min=3

--- Новый сегмент с индекса 193 (угол: 34.00°) ---
  Индекс 194: угол 77.00°, разница с avg 34.00° = 43.00°
    ! Выброс 1/2, пропускаем и продолжаем
  Индекс 195: угол 119.00°, разница с avg 34.00° = 85.00°
    ! Выброс 2/2, пропускаем и продолжаем
  Индекс 196: угол 150.00°, разница с avg 34.00° = 116.00°
    ✗ Превышен лимит выбросов или большая разница, конец сегмента
  ✗ Сегмент [193:195] отклонён: длина=1 < min=3

--- Новый сегмент с индекса 194 (угол: 77.00°) ---
  Индекс 195: угол 119.00°, разница с avg 77.00° = 42.00°
    ! Выброс 1/2, пропускаем и продолжаем
  Индекс 196: угол 150.00°, разница с avg 77.00° = 73.00°
    ! Выброс 2/2, пропускаем и продолжаем
  Индекс 197: угол 150.00°, разница с avg 77.00° = 73.00°
    ✗ Превышен лимит выбросов или большая разница, конец сегмента
  ✗ Сегмент [194:196] отклонён: длина=1 < min=3

--- Новый сегмент с индекса 195 (угол: 119.00°) ---
  Индекс 196: угол 150.00°, разница с avg 119.00° = 31.00°
    ! Выброс 1/2, пропускаем и продолжаем
  Индекс 197: угол 150.00°, разница с avg 119.00° = 31.00°
    ! Выброс 2/2, пропускаем и продолжаем
  Индекс 198: угол 150.00°, разница с avg 119.00° = 31.00°
    ✗ Превышен лимит выбросов или большая разница, конец сегмента
  ✗ Сегмент [195:197] отклонён: длина=1 < min=3

--- Новый сегмент с индекса 196 (угол: 150.00°) ---
  Индекс 197: угол 150.00°, разница с avg 150.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 198: угол 150.00°, разница с avg 150.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 199: угол 150.00°, разница с avg 150.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 200: угол 150.00°, разница с avg 150.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 201: угол 150.00°, разница с avg 150.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 202: угол 150.00°, разница с avg 150.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 203: угол 150.00°, разница с avg 150.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 204: угол 150.00°, разница с avg 150.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 205: угол 151.00°, разница с avg 150.00° = 1.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 206: угол 115.00°, разница с avg 150.10° = 35.10°
    ! Выброс 1/2, пропускаем и продолжаем
  Индекс 207: угол 116.00°, разница с avg 150.10° = 34.10°
    ! Выброс 2/2, пропускаем и продолжаем
  Индекс 208: угол 115.00°, разница с avg 150.10° = 35.10°
    ✗ Превышен лимит выбросов или большая разница, конец сегмента
  ✓ Сегмент [196:207] принят: длина=10, avg=150.10°, outliers=2

--- Новый сегмент с индекса 208 (угол: 115.00°) ---
  Индекс 209: угол 111.00°, разница с avg 115.00° = 4.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 210: угол 114.00°, разница с avg 113.00° = 1.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 211: угол 114.00°, разница с avg 113.33° = 0.67°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 212: угол 114.00°, разница с avg 113.50° = 0.50°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 213: угол 114.00°, разница с avg 113.60° = 0.40°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 214: угол 114.00°, разница с avg 113.67° = 0.33°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 215: угол 131.00°, разница с avg 113.71° = 17.29°
    ! Выброс 1/2, пропускаем и продолжаем
  Индекс 216: угол 134.00°, разница с avg 113.71° = 20.29°
    ! Выброс 2/2, пропускаем и продолжаем
  Индекс 217: угол 134.00°, разница с avg 113.71° = 20.29°
    ✗ Превышен лимит выбросов или большая разница, конец сегмента
  ✓ Сегмент [208:216] принят: длина=7, avg=113.71°, outliers=2

--- Новый сегмент с индекса 217 (угол: 134.00°) ---
  Индекс 218: угол 133.00°, разница с avg 134.00° = 1.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 219: угол 133.00°, разница с avg 133.50° = 0.50°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 220: угол 134.00°, разница с avg 133.33° = 0.67°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 221: угол 133.00°, разница с avg 133.50° = 0.50°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 222: угол 134.00°, разница с avg 133.40° = 0.60°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 223: угол 134.00°, разница с avg 133.50° = 0.50°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 224: угол 174.00°, разница с avg 133.57° = 40.43°
    ! Выброс 1/2, пропускаем и продолжаем
  Индекс 225: угол 174.00°, разница с avg 133.57° = 40.43°
    ! Выброс 2/2, пропускаем и продолжаем
  Индекс 226: угол 141.00°, разница с avg 133.57° = 7.43°
    ✗ Превышен лимит выбросов или большая разница, конец сегмента
  ✓ Сегмент [217:225] принят: длина=7, avg=133.57°, outliers=2

--- Новый сегмент с индекса 226 (угол: 141.00°) ---
  Индекс 227: угол 141.00°, разница с avg 141.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 228: угол 141.00°, разница с avg 141.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 229: угол 141.00°, разница с avg 141.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 230: угол 142.00°, разница с avg 141.00° = 1.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 231: угол 141.00°, разница с avg 141.20° = 0.20°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 232: угол 141.00°, разница с avg 141.17° = 0.17°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 233: угол 233.00°, разница с avg 141.14° = 91.86°
    ! Выброс 1/2, пропускаем и продолжаем
  Индекс 234: угол 234.00°, разница с avg 141.14° = 92.86°
    ! Выброс 2/2, пропускаем и продолжаем
  Индекс 235: угол 234.00°, разница с avg 141.14° = 92.86°
    ✗ Превышен лимит выбросов или большая разница, конец сегмента
  ✓ Сегмент [226:234] принят: длина=7, avg=141.14°, outliers=2

--- Новый сегмент с индекса 235 (угол: 234.00°) ---
  Индекс 236: угол 234.00°, разница с avg 234.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 237: угол 233.00°, разница с avg 234.00° = 1.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 238: угол 233.00°, разница с avg 233.67° = 0.67°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 239: угол 233.00°, разница с avg 233.50° = 0.50°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 240: угол 234.00°, разница с avg 233.40° = 0.60°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 241: угол 233.00°, разница с avg 233.50° = 0.50°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 242: угол 233.00°, разница с avg 233.43° = 0.43°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 243: угол 234.00°, разница с avg 233.37° = 0.63°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 244: угол 233.00°, разница с avg 233.44° = 0.44°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 245: угол 233.00°, разница с avg 233.40° = 0.40°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 246: угол 234.00°, разница с avg 233.36° = 0.64°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 247: угол 333.00°, разница с avg 233.42° = 99.58°
    ! Выброс 1/2, пропускаем и продолжаем
  Индекс 248: угол 333.00°, разница с avg 233.42° = 99.58°
    ! Выброс 2/2, пропускаем и продолжаем
  Индекс 249: угол 333.00°, разница с avg 233.42° = 99.58°
    ✗ Превышен лимит выбросов или большая разница, конец сегмента
  ✓ Сегмент [235:248] принят: длина=12, avg=233.42°, outliers=2

--- Новый сегмент с индекса 249 (угол: 333.00°) ---
  Индекс 250: угол 334.00°, разница с avg 333.00° = 1.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 251: угол 334.00°, разница с avg 333.50° = 0.50°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 252: угол 57.00°, разница с avg 333.67° = 83.33°
    ! Выброс 1/2, пропускаем и продолжаем
  Индекс 253: угол 57.00°, разница с avg 333.67° = 83.33°
    ! Выброс 2/2, пропускаем и продолжаем
  Индекс 254: угол 57.00°, разница с avg 333.67° = 83.33°
    ✗ Превышен лимит выбросов или большая разница, конец сегмента
  ✓ Сегмент [249:253] принят: длина=3, avg=333.67°, outliers=2

--- Новый сегмент с индекса 254 (угол: 57.00°) ---
  Индекс 255: угол 57.00°, разница с avg 57.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 256: угол 57.00°, разница с avg 57.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 257: угол 57.00°, разница с avg 57.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 258: угол 141.00°, разница с avg 57.00° = 84.00°
    ! Выброс 1/2, пропускаем и продолжаем
  Индекс 259: угол 141.00°, разница с avg 57.00° = 84.00°
    ! Выброс 2/2, пропускаем и продолжаем
  Индекс 260: угол 141.00°, разница с avg 57.00° = 84.00°
    ✗ Превышен лимит выбросов или большая разница, конец сегмента
  ✓ Сегмент [254:259] принят: длина=4, avg=57.00°, outliers=2

--- Новый сегмент с индекса 260 (угол: 141.00°) ---
  Индекс 261: угол 141.00°, разница с avg 141.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 262: угол 142.00°, разница с avg 141.00° = 1.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 263: угол 171.00°, разница с avg 141.33° = 29.67°
    ! Выброс 1/2, пропускаем и продолжаем
  Индекс 264: угол 233.00°, разница с avg 141.33° = 91.67°
    ! Выброс 2/2, пропускаем и продолжаем
  Индекс 265: угол 234.00°, разница с avg 141.33° = 92.67°
    ✗ Превышен лимит выбросов или большая разница, конец сегмента
  ✓ Сегмент [260:264] принят: длина=3, avg=141.33°, outliers=2

--- Новый сегмент с индекса 265 (угол: 234.00°) ---
  Индекс 266: угол 234.00°, разница с avg 234.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 267: угол 234.00°, разница с avg 234.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 268: угол 233.00°, разница с avg 234.00° = 1.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 269: угол 309.00°, разница с avg 233.75° = 75.25°
    ! Выброс 1/2, пропускаем и продолжаем
  Индекс 270: угол 100.00°, разница с avg 233.75° = 133.75°
    ! Выброс 2/2, пропускаем и продолжаем
  Индекс 271: угол 100.00°, разница с avg 233.75° = 133.75°
    ✗ Превышен лимит выбросов или большая разница, конец сегмента
  ✓ Сегмент [265:270] принят: длина=4, avg=233.75°, outliers=2

--- Новый сегмент с индекса 271 (угол: 100.00°) ---
  Индекс 272: угол 100.00°, разница с avg 100.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 273: угол 100.00°, разница с avg 100.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 274: угол 100.00°, разница с avg 100.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 275: угол 100.00°, разница с avg 100.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 276: угол 101.00°, разница с avg 100.00° = 1.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 277: угол 101.00°, разница с avg 100.17° = 0.83°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 278: угол 100.00°, разница с avg 100.29° = 0.29°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 279: угол 100.00°, разница с avg 100.25° = 0.25°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 280: угол 100.00°, разница с avg 100.22° = 0.22°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 281: угол 101.00°, разница с avg 100.20° = 0.80°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 282: угол 100.00°, разница с avg 100.27° = 0.27°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 283: угол 100.00°, разница с avg 100.25° = 0.25°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 284: угол 101.00°, разница с avg 100.23° = 0.77°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 285: угол 100.00°, разница с avg 100.29° = 0.29°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 286: угол 100.00°, разница с avg 100.27° = 0.27°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 287: угол 100.00°, разница с avg 100.25° = 0.25°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 288: угол 100.00°, разница с avg 100.24° = 0.24°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 289: угол 100.00°, разница с avg 100.22° = 0.22°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 290: угол 101.00°, разница с avg 100.21° = 0.79°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 291: угол 101.00°, разница с avg 100.25° = 0.75°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 292: угол 100.00°, разница с avg 100.29° = 0.29°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 293: угол 100.00°, разница с avg 100.27° = 0.27°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 294: угол 101.00°, разница с avg 100.26° = 0.74°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 295: угол 101.00°, разница с avg 100.29° = 0.71°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 296: угол 100.00°, разница с avg 100.32° = 0.32°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 297: угол 100.00°, разница с avg 100.31° = 0.31°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 298: угол 100.00°, разница с avg 100.30° = 0.30°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 299: угол 101.00°, разница с avg 100.29° = 0.71°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 300: угол 100.00°, разница с avg 100.31° = 0.31°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 301: угол 101.00°, разница с avg 100.30° = 0.70°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 302: угол 100.00°, разница с avg 100.32° = 0.32°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 303: угол 100.00°, разница с avg 100.31° = 0.31°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 304: угол 100.00°, разница с avg 100.30° = 0.30°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 305: угол 100.00°, разница с avg 100.29° = 0.29°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 306: угол 100.00°, разница с avg 100.29° = 0.29°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 307: угол 100.00°, разница с avg 100.28° = 0.28°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 308: угол 100.00°, разница с avg 100.27° = 0.27°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 309: угол 100.00°, разница с avg 100.26° = 0.26°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 310: угол 100.00°, разница с avg 100.26° = 0.26°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 311: угол 101.00°, разница с avg 100.25° = 0.75°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 312: угол 100.00°, разница с avg 100.27° = 0.27°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 313: угол 100.00°, разница с avg 100.26° = 0.26°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 314: угол 101.00°, разница с avg 100.26° = 0.74°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 315: угол 100.00°, разница с avg 100.27° = 0.27°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 316: угол 101.00°, разница с avg 100.27° = 0.73°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 317: угол 101.00°, разница с avg 100.28° = 0.72°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 318: угол 101.00°, разница с avg 100.30° = 0.70°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 319: угол 100.00°, разница с avg 100.31° = 0.31°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 320: угол 101.00°, разница с avg 100.31° = 0.69°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 321: угол 100.00°, разница с avg 100.32° = 0.32°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 322: угол 101.00°, разница с avg 100.31° = 0.69°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 323: угол 101.00°, разница с avg 100.33° = 0.67°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 324: угол 101.00°, разница с avg 100.34° = 0.66°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 325: угол 101.00°, разница с avg 100.35° = 0.65°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 326: угол 101.00°, разница с avg 100.36° = 0.64°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 327: угол 101.00°, разница с avg 100.37° = 0.63°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 328: угол 101.00°, разница с avg 100.39° = 0.61°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 329: угол 101.00°, разница с avg 100.40° = 0.60°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 330: угол 101.00°, разница с avg 100.41° = 0.59°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 331: угол 101.00°, разница с avg 100.42° = 0.58°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 332: угол 101.00°, разница с avg 100.43° = 0.57°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 333: угол 100.00°, разница с avg 100.44° = 0.44°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 334: угол 100.00°, разница с avg 100.43° = 0.43°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 335: угол 101.00°, разница с avg 100.42° = 0.58°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 336: угол 100.00°, разница с avg 100.43° = 0.43°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 337: угол 100.00°, разница с avg 100.42° = 0.42°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 338: угол 101.00°, разница с avg 100.42° = 0.58°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 339: угол 101.00°, разница с avg 100.43° = 0.57°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 340: угол 100.00°, разница с avg 100.43° = 0.43°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 341: угол 100.00°, разница с avg 100.43° = 0.43°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 342: угол 100.00°, разница с avg 100.42° = 0.42°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 343: угол 100.00°, разница с avg 100.42° = 0.42°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 344: угол 100.00°, разница с avg 100.41° = 0.41°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 345: угол 100.00°, разница с avg 100.41° = 0.41°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 346: угол 100.00°, разница с avg 100.40° = 0.40°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 347: угол 100.00°, разница с avg 100.39° = 0.39°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 348: угол 100.00°, разница с avg 100.39° = 0.39°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 349: угол 100.00°, разница с avg 100.38° = 0.38°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 350: угол 100.00°, разница с avg 100.38° = 0.38°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 351: угол 100.00°, разница с avg 100.37° = 0.37°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 352: угол 100.00°, разница с avg 100.37° = 0.37°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 353: угол 100.00°, разница с avg 100.37° = 0.37°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 354: угол 100.00°, разница с avg 100.36° = 0.36°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 355: угол 100.00°, разница с avg 100.36° = 0.36°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 356: угол 100.00°, разница с avg 100.35° = 0.35°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 357: угол 100.00°, разница с avg 100.35° = 0.35°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 358: угол 100.00°, разница с avg 100.34° = 0.34°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 359: угол 100.00°, разница с avg 100.34° = 0.34°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 360: угол 100.00°, разница с avg 100.34° = 0.34°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 361: угол 101.00°, разница с avg 100.33° = 0.67°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 362: угол 100.00°, разница с avg 100.34° = 0.34°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 363: угол 100.00°, разница с avg 100.34° = 0.34°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 364: угол 100.00°, разница с avg 100.33° = 0.33°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 365: угол 100.00°, разница с avg 100.33° = 0.33°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 366: угол 100.00°, разница с avg 100.33° = 0.33°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 367: угол 100.00°, разница с avg 100.32° = 0.32°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 368: угол 100.00°, разница с avg 100.32° = 0.32°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 369: угол 101.00°, разница с avg 100.32° = 0.68°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 370: угол 100.00°, разница с avg 100.32° = 0.32°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 371: угол 100.00°, разница с avg 100.32° = 0.32°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 372: угол 100.00°, разница с avg 100.32° = 0.32°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 373: угол 101.00°, разница с avg 100.31° = 0.69°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 374: угол 100.00°, разница с avg 100.32° = 0.32°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 375: угол 162.00°, разница с avg 100.32° = 61.68°
    ! Выброс 1/2, пропускаем и продолжаем
  Индекс 376: угол 232.00°, разница с avg 100.32° = 131.68°
    ! Выброс 2/2, пропускаем и продолжаем
  Индекс 377: угол 253.00°, разница с avg 100.32° = 152.68°
    ✗ Превышен лимит выбросов или большая разница, конец сегмента
  ✓ Сегмент [271:376] принят: длина=104, avg=100.32°, outliers=2

--- Новый сегмент с индекса 377 (угол: 253.00°) ---
  Индекс 378: угол 229.00°, разница с avg 253.00° = 24.00°
    ! Выброс 1/2, пропускаем и продолжаем
  Индекс 379: угол 217.00°, разница с avg 253.00° = 36.00°
    ! Выброс 2/2, пропускаем и продолжаем
  Индекс 380: угол 217.00°, разница с avg 253.00° = 36.00°
    ✗ Превышен лимит выбросов или большая разница, конец сегмента
  ✗ Сегмент [377:379] отклонён: длина=1 < min=3

--- Новый сегмент с индекса 378 (угол: 229.00°) ---
  Индекс 379: угол 217.00°, разница с avg 229.00° = 12.00°
    ! Выброс 1/2, пропускаем и продолжаем
  Индекс 380: угол 217.00°, разница с avg 229.00° = 12.00°
    ! Выброс 2/2, пропускаем и продолжаем
  Индекс 381: угол 218.00°, разница с avg 229.00° = 11.00°
    ✗ Превышен лимит выбросов или большая разница, конец сегмента
  ✗ Сегмент [378:380] отклонён: длина=1 < min=3

--- Новый сегмент с индекса 379 (угол: 217.00°) ---
  Индекс 380: угол 217.00°, разница с avg 217.00° = 0.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 381: угол 218.00°, разница с avg 217.00° = 1.00°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 382: угол 218.00°, разница с avg 217.33° = 0.67°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 383: угол 219.00°, разница с avg 217.50° = 1.50°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 384: угол 217.00°, разница с avg 217.80° = 0.80°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 385: угол 218.00°, разница с avg 217.67° = 0.33°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 386: угол 218.00°, разница с avg 217.71° = 0.29°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 387: угол 217.00°, разница с avg 217.75° = 0.75°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 388: угол 218.00°, разница с avg 217.67° = 0.33°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 389: угол 218.00°, разница с avg 217.70° = 0.30°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 390: угол 217.00°, разница с avg 217.73° = 0.73°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 391: угол 218.00°, разница с avg 217.67° = 0.33°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 392: угол 217.00°, разница с avg 217.69° = 0.69°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 393: угол 217.00°, разница с avg 217.64° = 0.64°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 394: угол 218.00°, разница с avg 217.60° = 0.40°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 395: угол 218.00°, разница с avg 217.62° = 0.38°
    ✓ Угол стабилен, добавлен в сегмент
  Индекс 396: угол 218.00°, разница с avg 217.65° = 0.35°
    ✓ Угол стабилен, добавлен в сегмент
  ✓ Сегмент [379:396] принят: длина=18, avg=217.67°, outliers=0

=== Слияние близких сегментов ===
Сравнение сег 1 (165.93°) и сег 2 (158.08°): разница=7.85°
  ✗ Оставлены раздельными
Сравнение сег 2 (158.08°) и сег 3 (151.21°): разница=6.87°
  ✗ Оставлены раздельными
Сравнение сег 3 (151.21°) и сег 4 (158.00°): разница=6.79°
  ✗ Оставлены раздельными
Сравнение сег 4 (158.00°) и сег 5 (150.10°): разница=7.90°
  ✗ Оставлены раздельными
Сравнение сег 5 (150.10°) и сег 6 (113.71°): разница=36.39°
  ✗ Оставлены раздельными
Сравнение сег 6 (113.71°) и сег 7 (133.57°): разница=19.86°
  ✗ Оставлены раздельными
Сравнение сег 7 (133.57°) и сег 8 (141.14°): разница=7.57°
  ✗ Оставлены раздельными
Сравнение сег 8 (141.14°) и сег 9 (233.42°): разница=92.27°
  ✗ Оставлены раздельными
Сравнение сег 9 (233.42°) и сег 10 (333.67°): разница=100.25°
  ✗ Оставлены раздельными
Сравнение сег 10 (333.67°) и сег 11 (57.00°): разница=83.33°
  ✗ Оставлены раздельными
Сравнение сег 11 (57.00°) и сег 12 (141.33°): разница=84.33°
  ✗ Оставлены раздельными
Сравнение сег 12 (141.33°) и сег 13 (233.75°): разница=92.42°
  ✗ Оставлены раздельными
Сравнение сег 13 (233.75°) и сег 14 (100.32°): разница=133.43°
  ✗ Оставлены раздельными
Сравнение сег 14 (100.32°) и сег 15 (217.67°): разница=117.35°
  ✗ Оставлены раздельными

=== Результаты поиска стабильных сегментов ===
Найдено сегментов: 15
Сегмент 1: индексы 0-77 (длина: 75), репрез. угол: 165.93°
Сегмент 2: индексы 78-152 (длина: 73), репрез. угол: 158.08°
Сегмент 3: индексы 153-168 (длина: 14), репрез. угол: 151.21°
Сегмент 4: индексы 169-190 (длина: 20), репрез. угол: 158.00°
Сегмент 5: индексы 196-207 (длина: 10), репрез. угол: 150.10°
Сегмент 6: индексы 208-216 (длина: 7), репрез. угол: 113.71°
Сегмент 7: индексы 217-225 (длина: 7), репрез. угол: 133.57°
Сегмент 8: индексы 226-234 (длина: 7), репрез. угол: 141.14°
Сегмент 9: индексы 235-248 (длина: 12), репрез. угол: 233.42°
Сегмент 10: индексы 249-253 (длина: 3), репрез. угол: 333.67°
Сегмент 11: индексы 254-259 (длина: 4), репрез. угол: 57.00°
Сегмент 12: индексы 260-264 (длина: 3), репрез. угол: 141.33°
Сегмент 13: индексы 265-270 (длина: 4), репрез. угол: 233.75°
Сегмент 14: индексы 271-376 (длина: 104), репрез. угол: 100.32°
Сегмент 15: индексы 379-396 (длина: 18), репрез. угол: 217.67°

=== Поиск поворотов на ~90° ===
Допуск поворота: ±10.00°
Всего стабильных сегментов: 15 (из 15 общих)

Стаб. сегмент 1 (индекс 1) -> стаб. сегмент 2 (индекс 2): 165.93° -> 158.08°, разница=7.85°
  ✗ Не поворот на 90°: |7.85° - 90°| = 82.15° > 10.00°

Стаб. сегмент 2 (индекс 2) -> стаб. сегмент 3 (индекс 3): 158.08° -> 151.21°, разница=6.87°
  ✗ Не поворот на 90°: |6.87° - 90°| = 83.13° > 10.00°

Стаб. сегмент 3 (индекс 3) -> стаб. сегмент 4 (индекс 4): 151.21° -> 158.00°, разница=6.79°
  ✗ Не поворот на 90°: |6.79° - 90°| = 83.21° > 10.00°

Стаб. сегмент 4 (индекс 4) -> стаб. сегмент 5 (индекс 5): 158.00° -> 150.10°, разница=7.90°
  ✗ Не поворот на 90°: |7.90° - 90°| = 82.10° > 10.00°

Стаб. сегмент 5 (индекс 5) -> стаб. сегмент 6 (индекс 6): 150.10° -> 113.71°, разница=36.39°
  ✗ Не поворот на 90°: |36.39° - 90°| = 53.61° > 10.00°

Стаб. сегмент 6 (индекс 6) -> стаб. сегмент 7 (индекс 7): 113.71° -> 133.57°, разница=19.86°
  ✗ Не поворот на 90°: |19.86° - 90°| = 70.14° > 10.00°

Стаб. сегмент 7 (индекс 7) -> стаб. сегмент 8 (индекс 8): 133.57° -> 141.14°, разница=7.57°
  ✗ Не поворот на 90°: |7.57° - 90°| = 82.43° > 10.00°

Стаб. сегмент 8 (индекс 8) -> стаб. сегмент 9 (индекс 9): 141.14° -> 233.42°, разница=92.27°
  ✓ Поворот найден! Diff=92.27° (цель: 90±10.00°), направление: по часовой

Стаб. сегмент 9 (индекс 9) -> стаб. сегмент 10 (индекс 10): 233.42° -> 333.67°, разница=100.25°
  ✗ Не поворот на 90°: |100.25° - 90°| = 10.25° > 10.00°

Стаб. сегмент 10 (индекс 10) -> стаб. сегмент 11 (индекс 11): 333.67° -> 57.00°, разница=83.33°
  ✓ Поворот найден! Diff=83.33° (цель: 90±10.00°), направление: по часовой

Стаб. сегмент 11 (индекс 11) -> стаб. сегмент 12 (индекс 12): 57.00° -> 141.33°, разница=84.33°
  ✓ Поворот найден! Diff=84.33° (цель: 90±10.00°), направление: по часовой

Стаб. сегмент 12 (индекс 12) -> стаб. сегмент 13 (индекс 13): 141.33° -> 233.75°, разница=92.42°
  ✓ Поворот найден! Diff=92.42° (цель: 90±10.00°), направление: по часовой

Стаб. сегмент 13 (индекс 13) -> стаб. сегмент 14 (индекс 14): 233.75° -> 100.32°, разница=133.43°
  ✗ Не поворот на 90°: |133.43° - 90°| = 43.43° > 10.00°

Стаб. сегмент 14 (индекс 14) -> стаб. сегмент 15 (индекс 15): 100.32° -> 217.67°, разница=117.35°
  ✗ Не поворот на 90°: |117.35° - 90°| = 27.35° > 10.00°

=== Валидация последовательности поворотов ===
✓ Найдено ровно 4 поворота
✓ Повороты идут последовательно без пересечений по индексам
Сумма поворотов: 352.36° (нормализовано: 352.36°)
Отклонение от 360°: 7.64°
✓ Сумма поворотов близка к 360° (отклонение: 7.64° ≤ 15.00°)
Поворот 1: 92.27° (отклонение от 90°: 2.27°)
Поворот 2: 83.33° (отклонение от 90°: 6.67°)
Поворот 3: 84.33° (отклонение от 90°: 5.67°)
Поворот 4: 92.42° (отклонение от 90°: 2.42°)

✓ Все проверки пройдены успешно!

╔════════════════════════════════════════════════════════════╗
║                    ИТОГОВЫЙ РЕЗУЛЬТАТ                     ║
╚════════════════════════════════════════════════════════════╝

Найдено стабильных сегментов: 15
Найдено поворотов на ~90°: 4

✓✓✓ КАЛИБРОВКА УСПЕШНА ✓✓✓

Последовательность поворотов:
  1. 141.14° → 233.42° (Δ = 92.27°)
  2. 333.67° → 57.00° (Δ = 83.33°)
  3. 57.00° → 141.33° (Δ = 84.33°)
  4. 141.33° → 233.75° (Δ = 92.42°)

============================================================)

---

## Что уже сделано

### ✅ Реализовано:

1. **Веб-интерфейс:**
   - Единичный анализ компаса
   - Пакетный анализ (массовая обработка)
   - История с группировкой по дням и фильтрами
   - Настройки алгоритма (сохранение в localStorage)

2. **Визуализация:**
   - График углов на полярной диаграмме (Chart.js)
   - Выделение зоны поворотов (🔵 синие точки)
   - Интерактивные tooltips

3. **Экспорт:**
   - JSON для детальных данных
   - CSV с результатами (Номер компаса, Результат, Углы поворотов)

4. **Фильтры и сортировка:**
   - В пакетном анализе: по статусу, 6 вариантов сортировки
   - В истории: по статусу и дате

### ❌ Проблемы:

1. **Алгоритм не проверяет направление поворотов** правильно
2. **Алгоритм пропускает повороты** когда между стабильными сегментами есть короткие переходные зоны
3. **localStorage переполняется** - модальное окно с кнопками не работает (кнопки не реагируют)

---

## Структура проекта

### Backend (Go):
```
analyzer/
  analyzer.go - основной алгоритм анализа
models/
  compass.go - структуры данных (Turn, CompassData)
parser/
  parser.go - чтение CSV файлов
webui/
  server.go - HTTP сервер и API endpoints
  static/
    index.html - HTML интерфейс
    app.js - JavaScript логика (~2200 строк)
    styles.css - стили
```

### Ключевые функции:

**Go (analyzer/analyzer.go):**
- `findStableSegments()` - поиск стабильных сегментов углов
- `find90DegreeTurns()` - поиск поворотов на ~90° между сегментами
- `validateTurnSequence()` - валидация последовательности
- `signedAngleDifference()` - вычисление знаковой разницы углов

**JavaScript (app.js):**
- `analyzeSingleFolder()` - единичный анализ
- `handleBatchAnalyzeStream()` - пакетная обработка с SSE
- `saveToHistory()` - сохранение в localStorage
- `displayPolarChart()` - отображение графика
- `generateCSVFromResults()` - генерация CSV

---

## Последние изменения

### Файл: `analyzer/analyzer.go` (строки 245-318)

**Текущая реализация `find90DegreeTurns()`:**
```go
func find90DegreeTurns(segments []AngleSegment, turnTolerance float64, logFile *os.File) []models.Turn {
    // Собираем только стабильные сегменты
    stableSegments := make([]struct {
        segment AngleSegment
        index   int
    }, 0)
    
    for i, seg := range segments {
        if seg.IsStable {
            stableSegments = append(stableSegments, ...)
        }
    }
    
    // Проверяем все пары стабильных сегментов
    for i := 1; i < len(stableSegments); i++ {
        prev := stableSegments[i-1]
        curr := stableSegments[i]
        
        prevAngle := prev.segment.AvgAngle
        currAngle := curr.segment.AvgAngle
        
        signedDiff := signedAngleDifference(prevAngle, currAngle)
        absDiff := math.Abs(signedDiff)
        
        // ПРОВЕРКА - вот здесь проблема!
        if math.Abs(absDiff-90) <= turnTolerance && signedDiff > 0 {
            turn := models.Turn{...}
            turns = append(turns, turn)
        }
    }
    
    return turns
}
```

**Проблема:** Проверка `signedDiff > 0` не работает для переходов через 0°!

---

## Примеры данных для тестирования

### Хороший компас (должен пройти):
**Папка:** `H:\Study\Успешно\1903`

**Ожидаемые углы:**
```
~30° (стабильный) → 
~120° (стабильный) → 
~210° (стабильный) → 
~300° (стабильный) → 
~30° (возврат)

4 поворота по ~90° каждый, все по часовой
```

### Плохой компас (должен НЕ пройти):
**Папка:** `H:\Study\Брак\[любая]`

**Проблемы могут быть:**
- < 4 поворотов
- Повороты в разных направлениях (туда-сюда)
- Углы не стабильны
- Нет полного круга (сумма ≠ 360°)

---

## Вопросы для помощи

### Вопрос 1: Проверка направления поворотов

Как правильно проверить, что ВСЕ 4 поворота идут **в одном направлении** (по часовой)?

**Текущая функция:**
```go
func signedAngleDifference(fromAngle, toAngle float64) float64 {
    diff := toAngle - fromAngle
    if diff > 180 {
        diff -= 360  // Корректировка для перехода через 360°
    } else if diff < -180 {
        diff += 360  // Корректировка для перехода через 0°
    }
    return diff
}
```

**Проблемные случаи:**
- `1° → 267°`: должно быть `-94°` (против часовой) ✗
- `267° → 1°`: должно быть `+94°` (по часовой) ✓

**Что не работает?**

### Вопрос 2: Модальное окно localStorage

Кнопки в модальном окне (`showQuotaExceededModal`) не работают:
- "Отмена" - не закрывает окно
- "Перейти к Истории" - не переключает вкладку
- "Очистить сейчас" - не очищает историю

**Код:**
```javascript
<button class="btn btn-secondary" onclick="closeQuotaModal()">
    Отмена
</button>
<button class="btn btn-primary" onclick="goToHistoryFromQuota()">
    Перейти к Истории
</button>
<button class="btn btn-error" onclick="clearHistoryFromQuota()">
    🗑️ Очистить сейчас
</button>
```

**Функции объявлены как:**
```javascript
window.closeQuotaModal = function() { ... }
window.goToHistoryFromQuota = function() { ... }
window.clearHistoryFromQuota = function() { ... }
```

**Что не так?**

---

## Запуск проекта

```powershell
cd H:\Study
$env:GOMODCACHE="C:\go_modules"
$env:GOCACHE="C:\go_modules\cache"
go run . web
```

Или скомпилированная версия:
```powershell
.\compass_analyzer_v2.exe web
```

**Браузер:** http://localhost:8080

---

## Логи для отладки

### Серверные логи (PowerShell):
```
📦 Потоковый пакетный анализ: начало обработки X папок
⏳ [1/X] Анализ: 1903
✅ Анализ завершен: isValid=true, найдено поворотов=4
```

### Браузерные логи (F12 Console):
```javascript
displayResults: Received data: {...}
💾 Сохранено в историю: 1903
🔍 Выбор папки: {folderName: "1903", parentPath: "H:\\Study\\Успешно", ...}
```

---

## Приоритетные задачи

1. **КРИТИЧНО:** Исправить алгоритм проверки направления поворотов
   - Файл: `analyzer/analyzer.go`, функция `find90DegreeTurns()`
   - Проблема: `signedDiff > 0` не работает для всех случаев

2. **ВАЖНО:** Исправить модальное окно localStorage
   - Файл: `webui/static/app.js`, функция `showQuotaExceededModal()`
   - Проблема: кнопки `onclick` не срабатывают

3. **ЖЕЛАТЕЛЬНО:** Оптимизировать размер данных в localStorage
   - Не сохранять полные логи в историю
   - Сжимать данные перед сохранением

---

## Дополнительная информация

- **ОС:** Windows 10
- **Go версия:** 1.21+
- **Браузер:** Любой современный (Chrome/Edge/Firefox)
- **Ограничения:**
  - localStorage лимит: ~5-10 МБ
  - Cyrillic пути в Go modules вызывают ошибки (поэтому `GOMODCACHE=C:\go_modules`)

---

## Формат данных

### CSV входной файл (`SB_CMPS.csv`):
```csv
A,B,C,D
1,00:00:00,34.00,OK
2,00:00:01,34.00,OK
...
```

### JSON ответ API:
```json
{
  "success": true,
  "isValid": true,
  "compass": "1903",
  "turns": [
    {
      "startAngle": 33.21,
      "endAngle": 192.93,
      "diff": 159.73,
      "startIndex": 30,
      "endIndex": 78
    }
  ],
  "allAngles": [34.0, 34.0, ...],
  "segments": [...],
  "log": "детальный текстовый лог"
}
```

---

**Начни с исправления алгоритма проверки направления поворотов в `analyzer/analyzer.go`**

Спасибо!

