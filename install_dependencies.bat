@echo off
chcp 65001 > nul
cls
echo.
echo ╔═══════════════════════════════════════════════════════════╗
echo ║         УСТАНОВКА ЗАВИСИМОСТЕЙ COMPASS ANALYZER          ║
echo ╚═══════════════════════════════════════════════════════════╝
echo.
echo Эта программа установит все необходимые библиотеки для работы GUI
echo.
echo ═══════════════════════════════════════════════════════════
echo.

echo 📦 Шаг 1: Проверка версии Go...
go version
if %ERRORLEVEL% NEQ 0 (
    echo.
    echo ❌ Go не установлен!
    echo.
    echo Скачай и установи Go с официального сайта:
    echo https://go.dev/dl/
    echo.
    echo После установки перезапусти этот батник.
    pause
    exit /b 1
)
echo ✅ Go найден!
echo.

echo ═══════════════════════════════════════════════════════════
echo.
echo 📦 Шаг 2: Очистка кеша модулей...
go clean -modcache
echo ✅ Кеш очищен!
echo.

echo ═══════════════════════════════════════════════════════════
echo.
echo 📦 Шаг 3: Обновление go.mod и go.sum...
go mod tidy
if %ERRORLEVEL% NEQ 0 (
    echo.
    echo ❌ Ошибка обновления модулей!
    pause
    exit /b 1
)
echo ✅ Модули обновлены!
echo.

echo ═══════════════════════════════════════════════════════════
echo.
echo 📦 Шаг 4: Загрузка Fyne GUI библиотеки...
echo    (это может занять несколько минут при первой установке)
echo.
go get fyne.io/fyne/v2@latest
if %ERRORLEVEL% NEQ 0 (
    echo.
    echo ❌ Ошибка загрузки Fyne!
    pause
    exit /b 1
)
echo ✅ Fyne загружен!
echo.

echo ═══════════════════════════════════════════════════════════
echo.
echo 📦 Шаг 5: Загрузка всех зависимостей...
go mod download
if %ERRORLEVEL% NEQ 0 (
    echo.
    echo ❌ Ошибка загрузки зависимостей!
    pause
    exit /b 1
)
echo ✅ Все зависимости загружены!
echo.

echo ═══════════════════════════════════════════════════════════
echo.
echo 📦 Шаг 6: Финальная проверка...
go mod verify
echo.

echo ╔═══════════════════════════════════════════════════════════╗
echo ║              ✅ УСТАНОВКА ЗАВЕРШЕНА!                    ║
echo ╚═══════════════════════════════════════════════════════════╝
echo.
echo Теперь можешь запустить приложение через:
echo   1. start_gui.bat  (двойной клик)
echo   2. go run main.go gui  (в консоли)
echo   3. compass_analyzer.exe gui  (после компиляции)
echo.
pause

